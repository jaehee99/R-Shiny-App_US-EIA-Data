---
title: "Load Data"
author: "David Wilbourne"
date: "4/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(eia)
library(lubridate)
```

```{r}
eia_set_key("8a87a727635f5c834e2799cd76fcb820")

# Create list of API calls using str_c
# Manually add electric grid regions, since they don't align with states
# Unnest and select relevant data
load_data <- str_c("EBA.", region_abbreviations, "-ALL.D.H") %>% 
  eia_series() %>% 
  mutate(region = c("California", "Carolinas", "Central", "Florida", "Mid-Atlantic", "Midwest", "New England", "New York", "Northwest", "Southeast", "Southwest", "Tennessee", "Texas")) %>% 
  unnest(data) %>% 
  select(region, "MWh" = value, "date_utc" = date)

# Existing timezones are UTC; create local time variable so plots are easier to intepret
load_data$date_local <- case_when(
  load_data$region == "California" ~ with_tz(load_data$date_utc, tzone = "America/Los_Angeles"),
  load_data$region == "Carolinas" ~ with_tz(load_data$date_utc, tzone = "America/New_York"),
  load_data$region == "Central" ~ with_tz(load_data$date_utc, tzone = "America/Denver"),
  load_data$region == "Florida" ~ with_tz(load_data$date_utc, tzone = "America/New_York"),
  load_data$region == "Mid-Atlantic" ~ with_tz(load_data$date_utc, tzone = "America/New_York"),
  load_data$region == "Midwest" ~ with_tz(load_data$date_utc, tzone = "America/New_York"),
  load_data$region == "New England" ~ with_tz(load_data$date_utc, tzone = "America/New_York"),
  load_data$region == "New York" ~ with_tz(load_data$date_utc, tzone = "America/New_York"),
  load_data$region == "Northwest" ~ with_tz(load_data$date_utc, tzone = "America/Los_Angeles"),
  load_data$region == "Southeast" ~ with_tz(load_data$date_utc, tzone = "America/New_York"),
  load_data$region == "Southwest" ~ with_tz(load_data$date_utc, tzone = "America/Denver"),
  load_data$region == "Tennessee" ~ with_tz(load_data$date_utc, tzone = "America/Chicago"),
  load_data$region == "Texas" ~ with_tz(load_data$date_utc, tzone = "America/Chicago")
)
```

```{r}
#test
load_data %>% 
  filter(floor_date(date_local, unit = "day") == ymd("2021-04-24")) %>% 
  filter(region == "New England" | region == "Southwest") %>% 
  ggplot(aes(x = date_local, y = MWh)) +
  geom_line(aes(color = region))
```

